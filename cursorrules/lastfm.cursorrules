---
globs: lib/lastfm*.ts,app/api/auth/lastfm/**/*.ts,lib/group-service.ts,lib/group-stats.ts,lib/weekly-utils.ts,app/api/groups/**/charts/**/*.ts
alwaysApply: false
---

# Cursor Rules for ChartsFM Project

## Last.fm API Integration

When implementing Last.fm API functionality, always reference the official Last.fm API documentation:
- **Main API Documentation**: https://www.last.fm/api
- **API Methods**: https://www.last.fm/api/methods
- **Authentication Spec**: https://www.last.fm/api/authspec

### Key API Endpoints
- Base URL: `https://ws.audioscrobbler.com/2.0/`
- Authentication: Use session keys stored in database (`lastfmSessionKey` field)
- API Key and Secret: Stored in environment variables (`LASTFM_API_KEY`, `LASTFM_API_SECRET`)

### Important Notes
- Always use authenticated API calls when accessing user-specific data
- Session keys are obtained during OAuth flow and stored in user records
- Use the `authenticatedLastFMCall` function from `lib/lastfm-auth.ts` for authenticated requests
- Use the `fetchLastFMData` function from `lib/lastfm.ts` for unauthenticated requests

### Common API Methods
- `user.getRecentTracks` - Get user's recent scrobbles
- `user.getTopTracks` - Get user's top tracks
- `user.getTopArtists` - Get user's top artists
- `user.getInfo` - Get user profile information
- `user.getFriends` - Get user's friends list

